pipeline {
    agent any
    parameters { 
        string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') 
    }
    stages {
        stage('Build') {
            steps {
                steps {
			withCredentials([file(credentialsId: 'secret_file_dev', variable: 'secret_file')]) {
                    		writeFile file: 'key/secret_file_dev.txt', text: readFile(secret_file)
			}
                }
                echo "Building.. ${params.DEPLOY_ENV}"
            }
        }
        stage('Test') {
            steps {
                echo "Testing.. ${params.DEPLOY_ENV}"
            }
        }
        stage('Deploy') {
            steps {
                echo "Deploying.... ${params.DEPLOY_ENV}"
            }
        }
    }
}
