pipeline {
    agent any
    parameters { 
        string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') 
	string(name: 'SECRET_ID', defaultValue: 'secret_file_dev', description: '')
    }
    stages {
        stage('Build') {
            steps {
                withCredentials([file(credentialsId: params.DEPLOY_ENV, variable: 'secret_file')]) {
			writeFile file: 'key/secret_file_dev.txt', text: readFile(secret_file)
		}
                echo "Building.. ${params.DEPLOY_ENV}"
            }
        }
        stage('Test') {
            steps {
                echo "Testing.. ${params.DEPLOY_ENV}"
            }
        }
        stage('Deploy') {
            steps {
                echo "Deploying.... ${params.DEPLOY_ENV}"
            }
        }
    }
}
